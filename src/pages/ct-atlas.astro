---
import BaseLayout from '../layouts/BaseLayout.astro';
import EEGAtlasCard from '../components/EEGAtlasCard.astro';
import AnnotatedEEG from '../components/AnnotatedEEG.astro';
import {
  allCTPatterns,
  basicPatterns,
  intermediatePatterns,
  advancedPatterns,
} from '../data/ct-atlas';
---

<BaseLayout title="Pediatric CT Atlas">
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-teal-700 via-teal-600 to-cyan-500 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 sm:py-14">
      <div class="text-center max-w-3xl mx-auto">
        <div class="inline-flex items-center gap-2 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full text-sm mb-4">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
          Interactive Learning Resource
        </div>
        <h1 class="text-3xl sm:text-4xl font-extrabold mb-3 leading-tight">
          Pediatric CT Atlas
        </h1>
        <p class="text-sm text-teal-100 mb-5 leading-relaxed">
          Interactive annotated pediatric head CT patterns for emergency and neurology education.
          Click or hover on numbered markers to explore key findings.
        </p>
        <div class="flex items-center justify-center gap-6 text-sm">
          <span class="flex items-center gap-1.5">
            <span class="w-3 h-3 rounded-full bg-green-300"></span>
            {basicPatterns.length} Basic
          </span>
          <span class="flex items-center gap-1.5">
            <span class="w-3 h-3 rounded-full bg-amber-300"></span>
            {intermediatePatterns.length} Intermediate
          </span>
          <span class="flex items-center gap-1.5">
            <span class="w-3 h-3 rounded-full bg-red-400"></span>
            {advancedPatterns.length} Advanced
          </span>
        </div>
      </div>
    </div>
  </section>

  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Filter tabs -->
    <div class="flex items-center gap-2 mb-6 overflow-x-auto pb-2">
      <button class="filter-btn active px-4 py-2 rounded-lg text-sm font-medium bg-teal-600 text-white" data-filter="all">
        All ({allCTPatterns.length})
      </button>
      <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200" data-filter="basic">
        Basic ({basicPatterns.length})
      </button>
      <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200" data-filter="intermediate">
        Intermediate ({intermediatePatterns.length})
      </button>
      <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200" data-filter="advanced">
        Advanced ({advancedPatterns.length})
      </button>
    </div>

    <!-- Card grid -->
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 mb-12" id="card-grid">
      {allCTPatterns.map(pattern => (
        <EEGAtlasCard
          id={pattern.id}
          title={pattern.title}
          imagePath={pattern.imagePath}
          difficulty={pattern.difficulty}
          description={pattern.description}
          annotationCount={pattern.annotations.length}
          modality="ct"
        />
      ))}
    </div>

    <!-- Full viewers -->
    <div class="space-y-8">
      <div class="atlas-section" data-section="basic">
        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-green-500"></span>
          Basic Patterns
        </h2>
        {basicPatterns.map(pattern => (
          <AnnotatedEEG
            id={pattern.id}
            title={pattern.title}
            imagePath={pattern.imagePath}
            imageAlt={pattern.imageAlt}
            annotations={pattern.annotations}
            difficulty={pattern.difficulty}
            window={pattern.window}
            plane={pattern.plane}
            clinicalSignificance={pattern.clinicalSignificance}
            source={pattern.source}
            license={pattern.license}
            modality="ct"
          />
        ))}
      </div>

      <div class="atlas-section" data-section="intermediate">
        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-amber-500"></span>
          Intermediate Patterns
        </h2>
        {intermediatePatterns.map(pattern => (
          <AnnotatedEEG
            id={pattern.id}
            title={pattern.title}
            imagePath={pattern.imagePath}
            imageAlt={pattern.imageAlt}
            annotations={pattern.annotations}
            difficulty={pattern.difficulty}
            window={pattern.window}
            plane={pattern.plane}
            clinicalSignificance={pattern.clinicalSignificance}
            source={pattern.source}
            license={pattern.license}
            modality="ct"
          />
        ))}
      </div>

      <div class="atlas-section" data-section="advanced">
        <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <span class="w-3 h-3 rounded-full bg-red-500"></span>
          Advanced Patterns
        </h2>
        {advancedPatterns.map(pattern => (
          <AnnotatedEEG
            id={pattern.id}
            title={pattern.title}
            imagePath={pattern.imagePath}
            imageAlt={pattern.imageAlt}
            annotations={pattern.annotations}
            difficulty={pattern.difficulty}
            window={pattern.window}
            plane={pattern.plane}
            clinicalSignificance={pattern.clinicalSignificance}
            source={pattern.source}
            license={pattern.license}
            modality="ct"
          />
        ))}
      </div>
    </div>

    <!-- CT Atlas Resources -->
    <div class="mt-12 rounded-xl border border-teal-200 bg-gradient-to-br from-teal-50 to-cyan-50 p-6">
      <div class="flex items-start gap-3 mb-4">
        <div class="w-10 h-10 bg-teal-600 rounded-lg flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
        </div>
        <div>
          <h2 class="text-lg font-bold text-slate-800">CT Atlas Resources</h2>
          <p class="text-sm text-slate-600 mt-1">
            Additional resources for pediatric head CT interpretation and emergency neuroimaging.
          </p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <a href="https://radiopaedia.org/articles/paediatric-head-ct?lang=us" target="_blank" rel="noopener noreferrer"
           class="block p-4 bg-white rounded-lg border border-slate-200 hover:border-teal-400 hover:shadow-md transition-all group">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-0.5 bg-green-100 text-green-800 text-[10px] font-semibold rounded">Free</span>
            <h3 class="text-sm font-bold text-slate-800 group-hover:text-teal-700">Radiopaedia â€” Pediatric Head CT</h3>
            <svg class="w-3.5 h-3.5 text-slate-400 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
          </div>
          <p class="text-xs text-slate-500 leading-relaxed">Comprehensive reference for pediatric head CT findings, normal anatomy, and common pathology with case examples.</p>
        </a>
        <a href="https://www.learningradiology.com/" target="_blank" rel="noopener noreferrer"
           class="block p-4 bg-white rounded-lg border border-slate-200 hover:border-teal-400 hover:shadow-md transition-all group">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-0.5 bg-green-100 text-green-800 text-[10px] font-semibold rounded">Free</span>
            <h3 class="text-sm font-bold text-slate-800 group-hover:text-teal-700">LearningRadiology.com</h3>
            <svg class="w-3.5 h-3.5 text-slate-400 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
          </div>
          <p class="text-xs text-slate-500 leading-relaxed">Educational radiology resource with structured approach to CT interpretation, featuring annotated cases and teaching files.</p>
        </a>
        <a href="https://pecarn.org/studyDatasets/StudyDetails?studyID=4" target="_blank" rel="noopener noreferrer"
           class="block p-4 bg-white rounded-lg border border-slate-200 hover:border-teal-400 hover:shadow-md transition-all group">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-0.5 bg-teal-100 text-teal-800 text-[10px] font-semibold rounded">PECARN</span>
            <h3 class="text-sm font-bold text-slate-800 group-hover:text-teal-700">PECARN Head Injury Decision Rules</h3>
            <svg class="w-3.5 h-3.5 text-slate-400 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
          </div>
          <p class="text-xs text-slate-500 leading-relaxed">Evidence-based clinical decision rules for identifying children at very low risk of clinically important traumatic brain injuries after head trauma.</p>
        </a>
        <a href="https://www.acr.org/Clinical-Resources/ACR-Appropriateness-Criteria" target="_blank" rel="noopener noreferrer"
           class="block p-4 bg-white rounded-lg border border-slate-200 hover:border-teal-400 hover:shadow-md transition-all group">
          <div class="flex items-center gap-2 mb-2">
            <span class="px-2 py-0.5 bg-blue-100 text-blue-800 text-[10px] font-semibold rounded">ACR</span>
            <h3 class="text-sm font-bold text-slate-800 group-hover:text-teal-700">ACR Appropriateness Criteria</h3>
            <svg class="w-3.5 h-3.5 text-slate-400 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
          </div>
          <p class="text-xs text-slate-500 leading-relaxed">American College of Radiology evidence-based guidelines for appropriate imaging, including pediatric head trauma and neurological indications.</p>
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<script>
  // Difficulty filter
  const filterBtns = document.querySelectorAll('.filter-btn');
  const cards = document.querySelectorAll('#card-grid .eeg-atlas-card');
  const sections = document.querySelectorAll('.atlas-section');

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const filter = btn.getAttribute('data-filter');
      filterBtns.forEach(b => {
        b.classList.remove('active', 'bg-teal-600', 'text-white');
        b.classList.add('bg-slate-100', 'text-slate-600');
      });
      btn.classList.add('active', 'bg-teal-600', 'text-white');
      btn.classList.remove('bg-slate-100', 'text-slate-600');

      cards.forEach(card => {
        const difficulty = card.getAttribute('data-difficulty');
        (card as HTMLElement).style.display = (filter === 'all' || difficulty === filter) ? '' : 'none';
      });
      sections.forEach(section => {
        const sectionType = section.getAttribute('data-section');
        (section as HTMLElement).style.display = (filter === 'all' || sectionType === filter) ? '' : 'none';
      });
    });
  });

  // URL hash scroll
  const hash = window.location.hash.slice(1);
  if (hash) {
    const target = document.getElementById(hash);
    if (target) {
      setTimeout(() => {
        target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    }
  }
</script>
